<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>


<div class="col-lg-12">
  <div  style="height:50px;">
    워드클라우드 테스트!!! 
  </div>
</div>

 

<div class="row">
  <div class="col-xs-4" style="border-style: solid;"><div id="D1" style="height: 300px;"><h1>Sample!! <br> WordCloud <br> 데이터수: 119개</h1></div></div>
  <div class="col-xs-8" style="border-style: solid;"><div id="D2"></div></div>
</div>


<script>


  showWordCloud();

  var widthChange = $(window).width();
  $(window).on('resize', function() {
    if ($(this).width() !== widthChange) {
      widthChange = $(this).width();
      $('#D2').empty();
      showWordCloud(); 
    }
  });

  function showWordCloud() {
    $('#D2').empty();
    var width2 = $("#" + "D2").width();
    var cloud2 = wordCloud("#D2", width2, 300);
    var words = [{ "text": "study", "size": 40 }, { "text": "motion", "size": 15 }, { "text": "forces", "size": 10 }, { "text": "electricity", "size": 15 }, { "text": "movement", "size": 10 }, { "text": "relation", "size": 5 }, { "text": "things", "size": 10 }, { "text": "force", "size": 5 }, { "text": "ad", "size": 5 }, { "text": "energy", "size": 85 }, { "text": "living", "size": 5 }, { "text": "nonliving", "size": 5 }, { "text": "laws", "size": 15 }, { "text": "speed", "size": 45 }, { "text": "velocity", "size": 30 }, { "text": "define", "size": 5 }, { "text": "constraints", "size": 5 }, { "text": "universe", "size": 10 }, { "text": "physics", "size": 120 }, { "text": "describing", "size": 5 }, { "text": "matter", "size": 90 }, { "text": "physics-the", "size": 5 }, { "text": "world", "size": 10 }, { "text": "works", "size": 10 }, { "text": "science", "size": 70 }, { "text": "interactions", "size": 30 }, { "text": "studies", "size": 5 }, { "text": "properties", "size": 45 }, { "text": "nature", "size": 40 }, { "text": "branch", "size": 30 }, { "text": "concerned", "size": 25 }, { "text": "source", "size": 40 }, { "text": "google", "size": 10 }, { "text": "defintions", "size": 5 }, { "text": "two", "size": 15 }, { "text": "grouped", "size": 15 }, { "text": "traditional", "size": 15 }, { "text": "fields", "size": 15 }, { "text": "acoustics", "size": 15 }, { "text": "optics", "size": 15 }, { "text": "mechanics", "size": 20 }, { "text": "thermodynamics", "size": 15 }, { "text": "electromagnetism", "size": 15 }, { "text": "modern", "size": 15 }, { "text": "extensions", "size": 15 }, { "text": "thefreedictionary", "size": 15 }, { "text": "interaction", "size": 15 }, { "text": "org", "size": 25 }, { "text": "answers", "size": 5 }, { "text": "natural", "size": 15 }, { "text": "objects", "size": 5 }, { "text": "treats", "size": 10 }, { "text": "acting", "size": 5 }, { "text": "department", "size": 5 }, { "text": "gravitation", "size": 5 }, { "text": "heat", "size": 10 }, { "text": "light", "size": 10 }, { "text": "magnetism", "size": 10 }, { "text": "modify", "size": 5 }, { "text": "general", "size": 10 }, { "text": "bodies", "size": 5 }, { "text": "philosophy", "size": 5 }, { "text": "brainyquote", "size": 5 }, { "text": "words", "size": 5 }, { "text": "ph", "size": 5 }, { "text": "html", "size": 5 }, { "text": "lrl", "size": 5 }, { "text": "zgzmeylfwuy", "size": 5 }, { "text": "subject", "size": 5 }, { "text": "distinguished", "size": 5 }, { "text": "chemistry", "size": 5 }, { "text": "biology", "size": 5 }, { "text": "includes", "size": 5 }, { "text": "radiation", "size": 5 }, { "text": "sound", "size": 5 }, { "text": "structure", "size": 5 }, { "text": "atoms", "size": 5 }, { "text": "including", "size": 10 }, { "text": "atomic", "size": 10 }, { "text": "nuclear", "size": 10 }, { "text": "cryogenics", "size": 10 }, { "text": "solid-state", "size": 10 }, { "text": "particle", "size": 10 }, { "text": "plasma", "size": 10 }, { "text": "deals", "size": 5 }, { "text": "merriam-webster", "size": 5 }, { "text": "dictionary", "size": 10 }, { "text": "analysis", "size": 5 }, { "text": "conducted", "size": 5 }, { "text": "order", "size": 5 }, { "text": "understand", "size": 5 }, { "text": "behaves", "size": 5 }, { "text": "en", "size": 5 }, { "text": "wikipedia", "size": 5 }, { "text": "wiki", "size": 5 }, { "text": "physics-", "size": 5 }, { "text": "physical", "size": 5 }, { "text": "behaviour", "size": 5 }, { "text": "collinsdictionary", "size": 5 }, { "text": "english", "size": 5 }, { "text": "time", "size": 35 }, { "text": "distance", "size": 35 }, { "text": "wheels", "size": 5 }, { "text": "revelations", "size": 5 }, { "text": "minute", "size": 5 }, { "text": "acceleration", "size": 20 }, { "text": "torque", "size": 5 }, { "text": "wheel", "size": 5 }, { "text": "rotations", "size": 5 }, { "text": "resistance", "size": 5 }, { "text": "momentum", "size": 5 }, { "text": "measure", "size": 10 }, { "text": "direction", "size": 10 }, { "text": "car", "size": 5 }, { "text": "add", "size": 5 }, { "text": "traveled", "size": 5 }, { "text": "weight", "size": 5 }, { "text": "electrical", "size": 5 }, { "text": "power", "size": 5 }];
    //사이즈에 따른 랭크 계산
    var wordsSizes = [];
    for (var i = 0; i < words.length; i++){
      wordsSizes.push(words[i].size); 
    } 
    //alert(wordsSizes);
    var sorted = wordsSizes.slice().sort(function(x,y){return y-x});
    console.log(sorted); //랭크 확인을 위한 
    var ranks = wordsSizes.map(function(v){ return sorted.indexOf(v)+1});
    console.log(ranks); 
    var newString = 'rank';
    //jsonArray에 랭크 추가!
    for (var i =0; i < words.length; i++) {
      words[i]['rank']=ranks[i];
      if ( words[i].rank < 10 ) {
        words[i].size = 100 - (words[i].rank * 10);
      }
      else {
        words[i].size = 5;
      }
      

    }


    alert(JSON.stringify(words));
    showNewWords(cloud2, words, width2, 300);
  }

  function showNewWords(vis,words, width, height) {   
      vis.update(words,width, height);
  }

  function wordCloud(selector, chartWidth, chartHeight) {
    var fill = d3.scale.category20();

    var svgTranslate = "translate(" + chartWidth / 2 + "," + chartHeight / 2 + ")";

    var svg = d3.select(selector).append("svg")
        .attr("width", chartWidth)
        .attr("height", chartHeight)
        .append("g")
        .attr("transform", svgTranslate);



    function draw(words) {
      var cloud = svg.selectAll("g text").data(words, function (d) { return d.text; })

      cloud.enter()
          .append("text")
          .style("font-family", "Impact")
          .style("fill", function (d, i) { return fill(i); })
          .attr("text-anchor", "middle")
          .attr('font-size', 1)
          .text(function (d) { return d.text; });

      cloud
          .transition()
          .duration(600)
          .style("font-size", function (d) { return d.size + "px"; })
          .attr("transform", function (d) {
            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
          })
          .style("fill-opacity", 1);

      cloud.exit()
          .transition()
          .duration(200)
          .style('fill-opacity', 1e-6)
          .attr('font-size', 1)
          .remove();
    }


    return {        
      update: function (words, chartWidth, chartHeight) {
        d3.layout.cloud().size([chartWidth, chartHeight])
          .words(words)
          .padding(5)
          .rotate(function () { return ~~(Math.random() * 2) * 90; })
          .font("Impact")
          .fontSize(function (d) { return d.size; })
          .on("end", draw)
          .start();
      }
    }

  }

</script>
